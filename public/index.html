<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiplayer Soccer</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <!-- Ranking lateral -->
    <div id="ranking-panel">
      <h3>üèÜ TOP 10</h3>
      <div id="ranking-list">Carregando...</div>
    </div>

    <div id="mobile-controls">
      <div id="joystick-container">
        <div id="joystick-base">
          <div id="joystick-thumb"></div>
        </div>
      </div>
      <button id="action-btn">CHUTAR</button>
    </div>

    <script>
      // Verificar autentica√ß√£o ANTES de carregar qualquer outro script
      if (!sessionStorage.getItem('token') && sessionStorage.getItem('isGuest') !== 'true') {
        // N√£o est√° logado nem como convidado, redireciona para login
        window.location.href = '/auth.html';
      }
    </script>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/dist/game.js"></script>
    <script>

      if (/Mobi|Android|iPhone/i.test(navigator.userAgent)) {
        document.getElementById('mobile-controls').style.display = 'flex';
        const actionBtn = document.getElementById('action-btn');
        if (actionBtn) actionBtn.style.display = 'none';
      }

      // Carregar ranking
      async function loadRanking() {
        try {
          const response = await fetch('/api/auth/ranking?limit=10');
          const data = await response.json();

          if (data.success && data.ranking) {
            const rankingList = document.getElementById('ranking-list');
            if (rankingList) {
              rankingList.innerHTML = `
                <div class="ranking-header">
                  <span class="rank-col">#</span>
                  <span class="player-col">Jogador</span>
                  <span class="stats-col">VIT</span>
                  <span class="stats-col">DER</span>
                  <span class="stats-col">EMP</span>
                  <span class="stats-col">SG</span>
                  <span class="stats-col">PJ</span>
                </div>
                ${data.ranking.map((player, index) => `
                  <div class="ranking-item">
                    <span class="rank">${index + 1}</span>
                    <span class="player-name">${player.username}</span>
                    <span class="wins">${player.wins}</span>
                    <span class="losses">${player.losses}</span>
                    <span class="draws">${player.draws}</span>
                    <span class="goals">${player.goals_difference > 0 ? '+' : ''}${player.goals_difference}</span>
                    <span class="matches">${player.matches_played}</span>
                  </div>
                `).join('')}
              `;
            }
          }
        } catch (error) {
          console.error('Erro ao carregar ranking:', error);
          const rankingList = document.getElementById('ranking-list');
          if (rankingList) {
            rankingList.innerHTML = '<p style="color: #888;">Erro ao carregar</p>';
          }
        }
      }

      loadRanking();
      // Atualiza ranking a cada 30 segundos
      setInterval(loadRanking, 30000);
    </script>
  </body>
</html>