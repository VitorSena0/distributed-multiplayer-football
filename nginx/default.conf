server {
    listen 80;
    server_name _;

    location / {
        proxy_pass http://app:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;

        # --- CRÍTICO PARA TESTE DE CARGA (Adicione isto) ---
        
        # Aumenta o tempo que o Nginx espera sem dados antes de fechar o socket
        # 3600s = 1 hora. Essencial para conexões persistentes longas.
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
        
        # Desativa o buffer para que as mensagens cheguem instantaneamente (baixa latência)
        proxy_buffering off;
    }
}

worker_processes auto; # Usa todos os núcleos da CPU da AWS

events {
    # Define o limite máximo de conexões simultâneas.
    # Deve ser maior que o número de usuários virtuais do seu teste.
    worker_connections 10240; 
    
    # Otimização para aceitar muitas conexões de uma vez
    multi_accept on;
}

http {
    # ... aqui entra o include ou o bloco server acima ...
}